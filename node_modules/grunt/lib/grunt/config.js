/*
 * grunt
 * http://gruntjs.com/
 *
 * Copyright (c) 2014 "Cowboy" Ben Alman
 * Licensed under the MIT license.
 * https://github.com/gruntjs/grunt/blob/master/LICENSE-MIT
 */

var grunt=require("../grunt"),config=module.exports=function(e,t){return arguments.length===2?config.set(e,t):config.get(e)};config.data={},config.escape=function(e){return e.replace(/\./g,"\\.")},config.getPropString=function(e){return Array.isArray(e)?e.map(config.escape).join("."):e},config.getRaw=function(e){return e?grunt.util.namespace.get(config.data,config.getPropString(e)):config.data};var propStringTmplRe=/^<%=\s*([a-z0-9_$]+(?:\.[a-z0-9_$]+)*)\s*%>$/i;config.get=function(e){return config.process(config.getRaw(e))},config.process=function(e){return grunt.util.recurse(e,function(e){if(typeof e!="string")return e;var t=e.match(propStringTmplRe),n;if(t){n=config.get(t[1]);if(n!=null)return n}return grunt.template.process(e,{data:config.data})})},config.set=function(e,t){return grunt.util.namespace.set(config.data,config.getPropString(e),t)},config.merge=function(e){return grunt.util._.merge(config.data,e),config.data},config.init=function(e){return grunt.verbose.write("Initializing config...").ok(),config.data=e||{}},config.requires=function(){var e=grunt.util.pluralize,t=grunt.util.toArray(arguments).map(config.getPropString),n="Verifying propert"+e(t.length,"y/ies")+" "+grunt.log.wordlist(t)+" exist"+e(t.length,"s")+" in config...";grunt.verbose.write(n);var r=config.data&&t.filter(function(e){return config.get(e)==null}).map(function(e){return'"'+e+'"'});if(config.data&&r.length===0)return grunt.verbose.ok(),!0;throw grunt.verbose.or.write(n),grunt.log.error().error("Unable to process task."),config.data?grunt.util.error("Required config propert"+e(r.length,"y/ies")+" "+r.join(", ")+" missing."):grunt.util.error("Unable to load config.")};