function _chmod(e,t,n){n||(e.length>0&&e.charAt(0)==="-"?(n=t,t=e,e=""):common.error("You must specify a file.")),e=common.parseOptions(e,{R:"recursive",c:"changes",v:"verbose"}),typeof n=="string"&&(n=[n]);var r;e.recursive?(r=[],common.expand(n).forEach(function i(e){var t=fs.lstatSync(e);t.isSymbolicLink()||(r.push(e),t.isDirectory()&&fs.readdirSync(e).forEach(function(t){i(e+"/"+t)}))})):r=common.expand(n),r.forEach(function(r){r=path.resolve(r),fs.existsSync(r)||common.error("File not found: "+r);if(e.recursive&&fs.lstatSync(r).isSymbolicLink())return;var i=fs.statSync(r).mode,s=i&PERMS.TYPE_MASK,o=i;isNaN(parseInt(t,8))?t.split(",").forEach(function(t){var n=/([ugoa]*)([=\+-])([rwxXst]*)/i,u=n.exec(t);if(u){var a=u[1],f=u[2],l=u[3],c=a.indexOf("u")!=-1||a==="a"||a==="",h=a.indexOf("g")!=-1||a==="a"||a==="",p=a.indexOf("o")!=-1||a==="a"||a==="",d=l.indexOf("r")!=-1,v=l.indexOf("w")!=-1,m=l.indexOf("x")!=-1,g=l.indexOf("t")!=-1,y=l.indexOf("s")!=-1,b=0;c&&(b|=(d?PERMS.OWNER_READ:0)+(v?PERMS.OWNER_WRITE:0)+(m?PERMS.OWNER_EXEC:0)+(y?PERMS.SETUID:0)),h&&(b|=(d?PERMS.GROUP_READ:0)+(v?PERMS.GROUP_WRITE:0)+(m?PERMS.GROUP_EXEC:0)+(y?PERMS.SETGID:0)),p&&(b|=(d?PERMS.OTHER_READ:0)+(v?PERMS.OTHER_WRITE:0)+(m?PERMS.OTHER_EXEC:0)),g&&(b|=PERMS.STICKY);switch(f){case"+":o|=b;break;case"-":o&=~b;break;case"=":o=s+b,fs.statSync(r).isDirectory()&&(o|=PERMS.SETUID+PERMS.SETGID&i)}e.verbose&&log(r+" -> "+o.toString(8)),i!=o&&(!e.verbose&&e.changes&&log(r+" -> "+o.toString(8)),fs.chmodSync(r,o))}else common.error("Invalid symbolic mode change: "+t)}):(o=s+parseInt(t,8),fs.statSync(r).isDirectory()&&(o|=PERMS.SETUID+PERMS.SETGID&i),fs.chmodSync(r,o))})}var common=require("./common"),fs=require("fs"),path=require("path"),PERMS=function(e){return{OTHER_EXEC:e.EXEC,OTHER_WRITE:e.WRITE,OTHER_READ:e.READ,GROUP_EXEC:e.EXEC<<3,GROUP_WRITE:e.WRITE<<3,GROUP_READ:e.READ<<3,OWNER_EXEC:e.EXEC<<6,OWNER_WRITE:e.WRITE<<6,OWNER_READ:e.READ<<6,STICKY:parseInt("01000",8),SETGID:parseInt("02000",8),SETUID:parseInt("04000",8),TYPE_MASK:parseInt("0770000",8)}}({EXEC:1,WRITE:2,READ:4});module.exports=_chmod;