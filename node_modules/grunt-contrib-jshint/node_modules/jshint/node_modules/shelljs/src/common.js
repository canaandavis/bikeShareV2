function log(){config.silent||console.log.apply(this,arguments)}function error(e,t){state.error===null&&(state.error=""),state.error+=state.currentCmd+": "+e+"\n",e.length>0&&log(state.error),config.fatal&&process.exit(1);if(!t)throw""}function ShellString(e){return e}function parseOptions(e,t){t||error("parseOptions() internal error: no map given");var n={};for(var r in t)n[t[r]]=!1;if(!e)return n;typeof e!="string"&&error("parseOptions() internal error: wrong str");var i=e.match(/^\-(.+)/);if(!i)return n;var s=i[1].split("");return s.forEach(function(e){e in t?n[t[e]]=!0:error("option not recognized: "+e)}),n}function expand(e){var t=[];return e.forEach(function(e){if(e.search(/\*[^\/]*\//)>-1||e.search(/\*\*[^\/]*\//)>-1){var n=e.match(/^([^*]+\/|)(.*)/),r=n[1],i=n[2],s=i.replace(/\*\*/g,".*").replace(/\*/g,"[^\\/]*");s=new RegExp(s),_ls("-R",r).filter(function(e){return s.test(e)}).forEach(function(e){t.push(e)})}else e.search(/\*/)>-1?_ls("",e).forEach(function(e){t.push(e)}):t.push(e)}),t}function unlinkSync(e){try{fs.unlinkSync(e)}catch(t){if(t.code!=="EPERM")throw t;fs.chmodSync(e,"0666"),fs.unlinkSync(e)}}function randomFileName(){function e(t){if(t===1)return parseInt(16*Math.random(),10).toString(16);var n="";for(var r=0;r<t;r++)n+=e(1);return n}return"shelljs_"+e(20)}function extend(e){var t=[].slice.call(arguments,1);return t.forEach(function(t){for(var n in t)e[n]=t[n]}),e}function wrap(e,t,n){return function(){var r=null;state.currentCmd=e,state.error=null;try{var i=[].slice.call(arguments,0);n&&n.notUnix?r=t.apply(this,i):((i.length===0||typeof i[0]!="string"||i[0][0]!=="-")&&i.unshift(""),r=t.apply(this,i))}catch(s){state.error||(console.log("shell.js: internal error"),console.log(s.stack||s),process.exit(1));if(config.fatal)throw s}return state.currentCmd="shell.js",r}}var os=require("os"),fs=require("fs"),_ls=require("./ls"),config={silent:!1,fatal:!1};exports.config=config;var state={error:null,currentCmd:"shell.js",tempDir:null};exports.state=state;var platform=os.type().match(/^Win/)?"win":"unix";exports.platform=platform,exports.log=log,exports.error=error,exports.ShellString=ShellString,exports.parseOptions=parseOptions,exports.expand=expand,exports.unlinkSync=unlinkSync,exports.randomFileName=randomFileName,exports.extend=extend,exports.wrap=wrap;