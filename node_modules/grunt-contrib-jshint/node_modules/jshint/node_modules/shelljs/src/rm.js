// Recursively removes 'dir'
// Adapted from https://github.com/ryanmcgrath/wrench-js
//
// Copyright (c) 2010 Ryan McGrath
// Copyright (c) 2012 Artur Adib
//
// Licensed under the MIT License
// http://www.opensource.org/licenses/mit-license.php

function rmdirSyncRecursive(e,t){var n;n=fs.readdirSync(e);for(var r=0;r<n.length;r++){var i=e+"/"+n[r],s=fs.lstatSync(i);if(s.isDirectory())rmdirSyncRecursive(i,t);else if(s.isSymbolicLink()){if(t||isWriteable(i))try{common.unlinkSync(i)}catch(o){common.error("could not remove file (code "+o.code+"): "+i,!0)}}else if(t||isWriteable(i))try{common.unlinkSync(i)}catch(o){common.error("could not remove file (code "+o.code+"): "+i,!0)}}var u;try{u=fs.rmdirSync(e)}catch(o){common.error("could not remove directory (code "+o.code+"): "+e,!0)}return u}function isWriteable(e){var t=!0;try{var n=fs.openSync(e,"a");fs.closeSync(n)}catch(r){t=!1}return t}function _rm(e,t){e=common.parseOptions(e,{f:"force",r:"recursive",R:"recursive"}),t||common.error("no paths given"),typeof t=="string"&&(t=[].slice.call(arguments,1)),t=common.expand(t),t.forEach(function(t){if(!fs.existsSync(t)){e.force||common.error("no such file or directory: "+t,!0);return}var n=fs.lstatSync(t);if(n.isFile()||n.isSymbolicLink()){if(e.force){common.unlinkSync(t);return}isWriteable(t)?common.unlinkSync(t):common.error("permission denied: "+t,!0);return}if(n.isDirectory()&&!e.recursive){common.error("path is a directory",!0);return}n.isDirectory()&&e.recursive&&rmdirSyncRecursive(t,e.force)})}var common=require("./common"),fs=require("fs");module.exports=_rm;