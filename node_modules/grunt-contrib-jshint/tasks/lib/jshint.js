/*
 * grunt-contrib-jshint
 * http://gruntjs.com/
 *
 * Copyright (c) 2013 "Cowboy" Ben Alman, contributors
 * Licensed under the MIT license.
 */

var path=require("path"),jshint=require("jshint").JSHINT,jshintcli=require("jshint/src/cli");exports.init=function(e){var t={usingGruntReporter:!1},n=function(e,t){while(e.length<t)e=" "+e;return e};return t.selectReporter=function(n){switch(!0){case n.reporter==="jslint":case n["jslint-reporter"]:n.reporter="jshint/src/reporters/jslint_xml.js";break;case n.reporter==="checkstyle":case n["checkstyle-reporter"]:n.reporter="jshint/src/reporters/checkstyle.js";break;case n["show-non-errors"]:n.reporter="jshint/src/reporters/non_error.js";break;case n.reporter!==undefined:n.reporter=path.resolve(process.cwd(),n.reporter)}var r;if(n.reporter)try{r=require(n.reporter).reporter,t.usingGruntReporter=!1}catch(i){e.fatal(i)}return r||(r=t.reporter,t.usingGruntReporter=!0),r},t.reporter=function(t,r){if(r.length<1){e.log.error("0 files linted. Please check your ignored files.");return}if(t.length===0){e.verbose.ok();return}var i=r[0].options;e.log.writeln();var s=null;t.forEach(function(t){t.file!==s&&e.log.writeln((t.file?"   "+t.file:"").bold),s=t.file;var r=t.error;if(!r)return;if(r.evidence){e.fail.errorcount++;var o=r.evidence.replace(/\t/g,e.util.repeat(i.indent," "));e.log.writeln(n(r.line.toString(),7)+" |"+o.grey),e.log.write(e.util.repeat(9," ")+e.util.repeat(r.character-1," ")+"^ "),e.verbose.write("["+r.code+"] "),e.log.writeln(r.reason)}else e.log.error(r.reason)}),e.log.writeln()},t.lint=function(n,r,i){var s={verbose:e.option("verbose"),extensions:""};r.extensions&&(s.extensions=r.extensions,delete r.extensions),r.ignores&&(typeof r.ignores=="string"&&(r.ignores=[r.ignores]),s.ignores=r.ignores,delete r.ignores),r.extract&&(s.extract=r.extract,delete r.extract);if(r.hasOwnProperty("reporterOutput")){var o=path.dirname(r.reporterOutput);delete r.reporterOutput}var u=t.selectReporter(r);["reporter","jslint-reporter","checkstyle-reporter","show-non-errors"].forEach(function(e){r.hasOwnProperty(e)&&delete r[e]}),r.jshintrc===!0?delete s.config:r.jshintrc?s.config=jshintcli.loadConfig(r.jshintrc):(e.option("debug")!==undefined&&(r.devel=r.debug=e.option("debug"),e.option("debug")&&(r.maxerr=Infinity)),s.config=r);var a=[],f=[];s.args=n,s.reporter=function(e,t){e.forEach(function(e){e.file=o?path.relative(o,e.file):e.file}),u(e,t,r),a=a.concat(e),f=f.concat(t)},jshintcli.run(s),i(a,f)},t};