var fs=require("fs"),collectable=module.exports;collectable.stdin=function(t,n){n||(n=t,t=!1);var r=this.nopt.argv,i=this;return n=n||function(e){e&&i.emit("error",e)},this._readFromStdin=!0,r?((!r.remain.length||t)&&this.readStdin(n),this):(this.once("stdin",n),this)},collectable.files=function(t){var n=this.nopt.argv,r=this;return t=t||function(e){e&&r.emit("error",e)},n?(n.remain.length&&this.readFiles(n.remain,t),this):(this.once("files",t),this)},collectable.readStdin=function(t){var n="",r=this;return process.stdin.setEncoding("utf8"),process.stdin.on("error",t),process.stdin.on("data",function(e){n+=e,r.emit("stdin:data",e)}).on("end",function(){r.emit("stdin",null,n),t(null,n)}).resume(),this},collectable.readFiles=function(t,n){var r="",i=this,s=t.slice(0);return function o(e){if(!e)return i.emit("files",null,r,t),n(null,r,t);fs.readFile(e,"utf8",function(e,t){if(e)return n(e);r+=t,i.emit("files:data",t),o(s.shift())})}(s.shift()),this},collectable.collect=function(t){return this.stdin(t).files(t)};