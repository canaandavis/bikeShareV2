function buf2binstring(e,t){if(t<65537)if(e.subarray&&STR_APPLY_UIA_OK||!e.subarray&&STR_APPLY_OK)return String.fromCharCode.apply(null,utils.shrinkBuf(e,t));var n="";for(var r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}var utils=require("./common"),STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}var _utf8len=new utils.Buf8(256);for(var i=0;i<256;i++)_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;_utf8len[254]=_utf8len[254]=1,exports.string2buf=function(e){var t,n,r,i,s,o=e.length,u=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=e.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),u+=n<128?1:n<2048?2:n<65536?3:4;t=new utils.Buf8(u);for(s=0,i=0;s<u;i++)n=e.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=e.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|n&63):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|n&63):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|n&63);return t},exports.buf2binstring=function(e){return buf2binstring(e,e.length)},exports.binstring2buf=function(e){var t=new utils.Buf8(e.length);for(var n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},exports.buf2string=function(e,t){var n,r,i,s,o=t||e.length,u=new Array(o*2);for(r=0,n=0;n<o;){i=e[n++];if(i<128){u[r++]=i;continue}s=_utf8len[i];if(s>4){u[r++]=65533,n+=s-1;continue}i&=s===2?31:s===3?15:7;while(s>1&&n<o)i=i<<6|e[n++]&63,s--;if(s>1){u[r++]=65533;continue}i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|i&1023)}return buf2binstring(u,r)},exports.utf8border=function(e,t){var n;t=t||e.length,t>e.length&&(t=e.length),n=t-1;while(n>=0&&(e[n]&192)===128)n--;return n<0?t:n===0?t:n+_utf8len[e[n]]>t?n:t};