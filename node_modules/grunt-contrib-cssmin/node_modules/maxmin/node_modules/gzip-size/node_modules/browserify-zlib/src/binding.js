function Zlib(e){if(e<exports.DEFLATE||e>exports.UNZIP)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function bufferSet(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}var msg=require("pako/lib/zlib/messages"),zstream=require("pako/lib/zlib/zstream"),zlib_deflate=require("pako/lib/zlib/deflate.js"),zlib_inflate=require("pako/lib/zlib/inflate.js"),constants=require("pako/lib/zlib/constants");for(var key in constants)exports[key]=constants[key];exports.NONE=0,exports.DEFLATE=1,exports.INFLATE=2,exports.GZIP=3,exports.GUNZIP=4,exports.DEFLATERAW=5,exports.INFLATERAW=6,exports.UNZIP=7,Zlib.prototype.init=function(e,t,n,r,i){this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=r;if(this.mode===exports.GZIP||this.mode===exports.GUNZIP)this.windowBits+=16;this.mode===exports.UNZIP&&(this.windowBits+=32);if(this.mode===exports.DEFLATERAW||this.mode===exports.INFLATERAW)this.windowBits=-this.windowBits;this.strm=new zstream;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var s=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:var s=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(s!==exports.Z_OK){this._error(s);return}this.write_in_progress=!1,this.init_done=!0},Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")},Zlib.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===exports.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},Zlib.prototype.write=function(e,t,n,r,i,s,o){this._writeCheck(),this.write_in_progress=!0;var u=this;return process.nextTick(function(){u.write_in_progress=!1;var a=u._write(e,t,n,r,i,s,o);u.callback(a[0],a[1]),u.pending_close&&u.close()}),this},Zlib.prototype.writeSync=function(e,t,n,r,i,s,o){return this._writeCheck(),this._write(e,t,n,r,i,s,o)},Zlib.prototype._write=function(e,t,n,r,i,s,o){this.write_in_progress=!0;if(e!==exports.Z_NO_FLUSH&&e!==exports.Z_PARTIAL_FLUSH&&e!==exports.Z_SYNC_FLUSH&&e!==exports.Z_FULL_FLUSH&&e!==exports.Z_FINISH&&e!==exports.Z_BLOCK)throw new Error("Invalid flush value");t==null&&(t=new Buffer(0),r=0,n=0),i._set?i.set=i._set:i.set=bufferSet;var u=this.strm;u.avail_in=r,u.input=t,u.next_in=n,u.avail_out=o,u.output=i,u.next_out=s;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var a=zlib_deflate.deflate(u,e);break;case exports.UNZIP:case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:var a=zlib_inflate.inflate(u,e);break;default:throw new Error("Unknown mode "+this.mode)}return a!==exports.Z_STREAM_END&&a!==exports.Z_OK&&this._error(a),this.write_in_progress=!1,[u.avail_in,u.avail_out]},Zlib.prototype.close=function(){if(this.write_in_progress){this.pending_close=!0;return}this.pending_close=!1,this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW?zlib_deflate.deflateEnd(this.strm):zlib_inflate.inflateEnd(this.strm),this.mode=exports.NONE},Zlib.prototype.reset=function(){switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:var e=zlib_deflate.deflateReset(this.strm);break;case exports.INFLATE:case exports.INFLATERAW:var e=zlib_inflate.inflateReset(this.strm)}e!==exports.Z_OK&&this._error(e)},Zlib.prototype._error=function(e){this.onerror(msg[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()},exports.Zlib=Zlib;