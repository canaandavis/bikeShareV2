function deflate(e,t){var n=new Deflate(t);n.push(e,!0);if(n.err)throw n.msg;return n.result}function deflateRaw(e,t){return t=t||{},t.raw=!0,deflate(e,t)}function gzip(e,t){return t=t||{},t.gzip=!0,deflate(e,t)}var zlib_deflate=require("./zlib/deflate.js"),utils=require("./utils/common"),strings=require("./utils/strings"),msg=require("./zlib/messages"),zstream=require("./zlib/zstream"),Z_NO_FLUSH=0,Z_FINISH=4,Z_OK=0,Z_STREAM_END=1,Z_DEFAULT_COMPRESSION=-1,Z_DEFAULT_STRATEGY=0,Z_DEFLATED=8,Deflate=function(e){this.options=utils.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var n=zlib_deflate.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Z_OK)throw new Error(msg[n]);t.header&&zlib_deflate.deflateSetHeader(this.strm,t.header)};Deflate.prototype.push=function(e,t){var n=this.strm,r=this.options.chunkSize,i,s;if(this.ended)return!1;s=t===~~t?t:t===!0?Z_FINISH:Z_NO_FLUSH,typeof e=="string"?n.input=strings.string2buf(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{n.avail_out===0&&(n.output=new utils.Buf8(r),n.next_out=0,n.avail_out=r),i=zlib_deflate.deflate(n,s);if(i!==Z_STREAM_END&&i!==Z_OK)return this.onEnd(i),this.ended=!0,!1;if(n.avail_out===0||n.avail_in===0&&s===Z_FINISH)this.options.to==="string"?this.onData(strings.buf2binstring(utils.shrinkBuf(n.output,n.next_out))):this.onData(utils.shrinkBuf(n.output,n.next_out))}while((n.avail_in>0||n.avail_out===0)&&i!==Z_STREAM_END);return s===Z_FINISH?(i=zlib_deflate.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Z_OK):!0},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},exports.Deflate=Deflate,exports.deflate=deflate,exports.deflateRaw=deflateRaw,exports.gzip=gzip;