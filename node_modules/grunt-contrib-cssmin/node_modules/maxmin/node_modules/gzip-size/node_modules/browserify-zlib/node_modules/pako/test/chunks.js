function randomBuf(e){var t=new pako_utils.Buf8(e);for(var n=0;n<e;n++)t[n]=Math.round(Math.random()*256);return t}function testChunk(e,t,n,r){var i,s,o,u,a,f,l=n.onData,c=0;n.onData=function(){c++,l.apply(this,arguments)},o=Math.ceil(e.length/r),u=0;for(i=0;i<o;i++)a=e.length-u<r?e.length-u:r,s=new pako_utils.Buf8(a),pako_utils.arraySet(s,e,u,a,0),n.push(s,i===o-1),u+=r;f=Math.ceil(n.result.length/16384),assert(!n.err,"Packer error: "+n.err),assert(helpers.cmpBuf(n.result,t),"Result is different"),assert.equal(c,f,"onData called "+c+"times, expected: "+f)}var assert=require("assert"),helpers=require("./helpers"),pako_utils=require("../lib/utils/common"),pako=require("../index"),samples=helpers.loadSamples();describe("Small input chunks",function(){it("deflate 100b by 1b chunk",function(){var e=randomBuf(100),t=pako.deflate(e);testChunk(e,t,new pako.Deflate,1)}),it("deflate 20000b by 10b chunk",function(){var e=randomBuf(2e4),t=pako.deflate(e);testChunk(e,t,new pako.Deflate,10)}),it("inflate 100b result by 1b chunk",function(){var e=randomBuf(100),t=pako.deflate(e);testChunk(t,e,new pako.Inflate,1)}),it("inflate 20000b result by 10b chunk",function(){var e=randomBuf(2e4),t=pako.deflate(e);testChunk(t,e,new pako.Inflate,10)})}),describe("Dummy push (force end)",function(){it("deflate end",function(){var e=samples.lorem_utf_100k,t=new pako.Deflate;t.push(e),t.push([],!0),assert(helpers.cmpBuf(t.result,pako.deflate(e)))}),it("inflate end",function(){var e=pako.deflate(samples.lorem_utf_100k),t=new pako.Inflate;t.push(e),t.push([],!0),assert(helpers.cmpBuf(t.result,pako.inflate(e)))})}),describe("Edge condition",function(){it("should be ok on buffer border",function(){var e,t=new Uint8Array(16385);for(e=0;e<t.length;e++)t[e]=Math.floor(Math.random()*255.999);var n=pako.deflate(t),r=new pako.Inflate;for(e=0;e<n.length;e++)r.push(n.subarray(e,e+1),!1),assert.ok(!r.err,"Inflate failed with status "+r.err);r.push(new Uint8Array(0),!0),assert.ok(!r.err,"Inflate failed with status "+r.err),assert(helpers.cmpBuf(t,r.result))})});