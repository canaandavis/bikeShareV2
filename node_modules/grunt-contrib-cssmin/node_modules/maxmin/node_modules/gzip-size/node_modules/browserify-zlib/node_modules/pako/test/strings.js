function fixedFromCharCode(e){if(e>65535){e-=65536;var t=55296+(e>>10),n=56320+(e&1023);return String.fromCharCode(t,n)}return String.fromCharCode(e)}function a2utf16(e){var t="";return e.forEach(function(e){if(typeof e=="string"){t+=e;return}t+=fixedFromCharCode(e)}),t}var fs=require("fs"),path=require("path"),assert=require("assert"),pako=require("../index"),cmp=require("./helpers").cmpBuf,strings=require("../lib/utils/strings");describe("Encode/Decode",function(){var e=a2utf16([127925,"a",9834,53,59392,1114111,1048575]),t=new Uint8Array(new Buffer(e));it("utf-8 border detect",function(){var e=strings.utf8border;assert.equal(e(t,1),1),assert.equal(e(t,2),2),assert.equal(e(t,3),3),assert.equal(e(t,4),4),assert.equal(e(t,5),5),assert.equal(e(t,6),5),assert.equal(e(t,7),5),assert.equal(e(t,8),8),assert.equal(e(t,9),9),assert.equal(e(t,10),9),assert.equal(e(t,11),9),assert.equal(e(t,12),12),assert.equal(e(t,13),12),assert.equal(e(t,14),12),assert.equal(e(t,15),12),assert.equal(e(t,16),16),assert.equal(e(t,17),16),assert.equal(e(t,18),16),assert.equal(e(t,19),16),assert.equal(e(t,20),20)}),it("Encode string to utf8 buf",function(){assert.ok(cmp(strings.string2buf(e),t))}),it("Decode utf8 buf to string",function(){assert.ok(strings.buf2string(t),e)})}),describe("Deflate/Inflate strings",function(){var e=path.join(__dirname,"fixtures/samples/lorem_utf_100k.txt"),t=fs.readFileSync(e,"utf8"),n=new Uint8Array(fs.readFileSync(e));it("Deflate javascript string (utf16) on input",function(){assert.ok(cmp(pako.deflate(t),pako.deflate(n)))}),it("Deflate with binary string output",function(){var e=pako.deflate(n,{to:"string",chunkSize:99});assert.equal(typeof e,"string"),assert.ok(cmp(new Buffer(e,"binary"),pako.deflate(n)))}),it("Inflate binary string input",function(){var e=pako.deflate(n,{to:"string"}),t=pako.deflate(n);assert.ok(cmp(pako.inflate(e),pako.inflate(t)))}),it("Inflate with javascript string (utf16) output",function(){var e=pako.deflate(n),r=pako.inflate(e,{to:"string",chunkSize:99});assert.equal(typeof r,"string"),assert.equal(r,t)})});