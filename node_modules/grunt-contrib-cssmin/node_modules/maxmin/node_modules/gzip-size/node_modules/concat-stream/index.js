function ConcatStream(e,t){if(!(this instanceof ConcatStream))return new ConcatStream(e,t);typeof e=="function"&&(t=e,e={}),e||(e={});var n=e.encoding,r=!1;if(!n)r=!0;else{n=String(n).toLowerCase();if(n==="u8"||n==="uint8")n="uint8array"}Writable.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=r,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}function isArrayish(e){return/Array\]$/.test(Object.prototype.toString.call(e))}function stringConcat(e){var t=[],n=!1;for(var r=0;r<e.length;r++){var i=e[r];typeof i=="string"?t.push(i):Buffer.isBuffer(i)?t.push(i):t.push(Buffer(i))}return Buffer.isBuffer(e[0])?(t=Buffer.concat(t),t=t.toString("utf8")):t=t.join(""),t}function bufferConcat(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];Buffer.isBuffer(r)?t.push(r):typeof r=="string"||isArrayish(r)||r&&typeof r.subarray=="function"?t.push(Buffer(r)):t.push(Buffer(String(r)))}return Buffer.concat(t)}function arrayConcat(e){var t=[];for(var n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}function u8Concat(e){var t=0;for(var n=0;n<e.length;n++)typeof e[n]=="string"&&(e[n]=Buffer(e[n])),t+=e[n].length;var r=new U8(t);for(var n=0,i=0;n<e.length;n++){var s=e[n];for(var o=0;o<s.length;o++)r[i++]=s[o]}return r}var Writable=require("readable-stream").Writable,inherits=require("inherits"),TA=require("typedarray"),U8=typeof Uint8Array!="undefined"?Uint8Array:TA.Uint8Array;module.exports=ConcatStream,inherits(ConcatStream,Writable),ConcatStream.prototype._write=function(e,t,n){this.body.push(e),n()},ConcatStream.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return Buffer.isBuffer(t)?"buffer":typeof Uint8Array!="undefined"&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":typeof t=="string"?"string":Object.prototype.toString.call(t)==="[object Object]"?"object":"buffer"},ConcatStream.prototype.getBody=function(){return!this.encoding&&this.body.length===0?[]:(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),this.encoding==="array"?arrayConcat(this.body):this.encoding==="string"?stringConcat(this.body):this.encoding==="buffer"?bufferConcat(this.body):this.encoding==="uint8array"?u8Concat(this.body):this.body)};var isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"};