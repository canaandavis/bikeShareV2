module.exports=function(){var e=function(e){return e.value==="__hack"},t=function(t,n,r,i){var s={},o=function(e,t,n){var i={},o;if(!n&&s[e])for(var u=0;u<r[e].components.length;u++){var a=r[e].components[u];i[a]=[];if(!s[e].found[a])continue;for(var f=0;f<s[e].found[a].length;f++){var l=s[e].found[a][f];if(l.isMarkedForDeletion)continue;i[a].push(l),l.position&&(!o||l.position<o)&&(o=l.position)}}s[e]={lastShorthand:t,found:i,shorthandPosition:o}},u=function(e,t){var n=r[e.prop].componentOf;s[n]||o(n),s[n].found[e.prop]||(s[n].found[e.prop]=[]),s[n].found[e.prop].push(e),!s[n].shorthandPosition&&t&&(s[n].shorthandPosition=t)},a=function(a){var f,l=r[a].components.length;if(!s[a]||!s[a].found)return!1;var c=[],h=[];for(f=0;f<l;f++){var p=r[a].components[f];if(s[a].found[p]&&s[a].found[p].length){var d=s[a].found[p][0];c.push(d),d.isReal!==!1&&h.push(d)}else{if(!s[a].lastShorthand)return!1;var v=s[a].lastShorthand.components[f].clone(n);c.push(v)}}if(h.length===0)return!1;if(h.length===l){var m=!0,g=!0,y;for(var b=0;b<h.length;b++){var w=h[b];r[w.prop].canOverride(r[w.prop].defaultValue,w.value)||(m=!1);var E=w.value.indexOf("(");if(E>=0){var S=w.value.substring(0,E);y?g=g&&S===y:y=S}}if(!m||!g)return!1}var x=r[a].putTogether(a,c,n);x instanceof Array||(x=[x]);var T=i.getDetokenizedLength(x),N=i.getDetokenizedLength(h);if(h.length===l||T<N||c.some(e)){x[0].isShorthand=!0,x[0].components=r[a].breakUp(x[0]);for(f=0;f<h.length;f++)h[f].isMarkedForDeletion=!0;t[s[a].shorthandPosition].replaceWith=x,o(a,x[0]);for(f=1;f<x.length;f++)u(x[f]);return!0}return!1},f=function(){for(var e in s)if(s.hasOwnProperty(e))while(a(e));},l,c;for(l=0;l<t.length;l++){c=t[l];if(c.isMarkedForDeletion)continue;if(!r[c.prop])continue;if(r[c.prop].isShorthand){if(c.isImportant===n||c.isImportant&&!n){while(a(c.prop));o(c.prop,c,!0)}}else{if(!r[c.prop].componentOf)continue;if(c.isImportant===n)c.position=l,u(c,l);else if(!n&&c.isImportant){var h=new i(c.prop,c.value,n);h.isIrrelevant=!0,h.isReal=!1,u(h)}}}f();var p=[];for(l=0;l<t.length;l++){c=t[l];if(c.replaceWith)for(var d=0;d<c.replaceWith.length;d++)p.push(c.replaceWith[d]);c.isMarkedForDeletion||p.push(c),c.isMarkedForDeletion=!1,c.replaceWith=null}return p};return{compactShorthands:t}}();