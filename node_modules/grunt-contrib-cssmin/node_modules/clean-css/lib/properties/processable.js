module.exports=function(){var e=require("./token"),t=require("./validator"),n=require("../text/splitter"),r={always:function(){return!0},sameValue:function(e,t){return e===t},sameFunctionOrValue:function(e,n){return t.areSameFunction(e,n)?!0:e===n},unit:function(e,n){return t.isValidUnitWithoutFunction(n)?!0:t.isValidUnitWithoutFunction(e)?!1:t.isValidFunctionWithoutVendorPrefix(n)&&t.isValidFunctionWithoutVendorPrefix(e)?!0:r.sameFunctionOrValue(e,n)},color:function(e,n){return t.isValidNamedColor(n)||t.isValidHexColor(n)?!0:t.isValidNamedColor(e)||t.isValidHexColor(e)?!1:t.isValidRgbaColor(n)||t.isValidHslaColor(n)?!0:t.isValidRgbaColor(e)||t.isValidHslaColor(e)?!1:r.sameFunctionOrValue(e,n)},backgroundImage:function(e,n){return n==="none"||n==="inherit"||t.isValidUrl(n)?!0:e==="none"||e==="inherit"||t.isValidUrl(e)?!1:r.sameFunctionOrValue(e,n)},border:function(e,t){var n=i.border(c.tokenizeOne(e)),s=i.border(c.tokenizeOne(t));return r.color(n[2].value,s[2].value)}};r=Object.freeze(r);var i={};i.takeCareOfFourValues=function(e){return function(t){var n=o[t.prop],r=[],i=e(t.value);if(i.length===0||i.length<n.components.length&&n.components.length>4)return[t];i.length<n.components.length&&i.length<2&&(i[1]=i[0]),i.length<n.components.length&&i.length<3&&(i[2]=i[0]),i.length<n.components.length&&i.length<4&&(i[3]=i[1]);for(var s=0;s<n.components.length;s++){var u=new c(n.components[s],i[s],t.isImportant);r.push(u)}return r}},i.fourBySpaces=i.takeCareOfFourValues(function(e){return(new n(" ")).split(e).filter(function(e){return e})}),i.commaSeparatedMulitpleValues=function(e){return function(t){if(t.value.indexOf(",")===-1)return e(t);var r=(new n(",")).split(t.value),i=[];for(var s=0,o=r.length;s<o;s++)t.value=r[s],i.push(e(t));for(var u=0,a=i[0].length;u<a;u++){for(var f=0,l=i.length,c=[];f<l;f++)c.push(i[f][u].value);i[0][u].value=c.join(",")}return i[0]}},i.background=function(e){var r=c.makeDefaults(["background-image","background-position","background-size","background-repeat","background-attachment","background-color"],e.isImportant),i=r[0],s=r[1],u=r[2],a=r[3],f=r[4],l=r[5];if(e.value==="inherit")return l.value=i.value=a.value=s.value=u.value=f.value="inherit",r;var h=(new n(" ")).split(e.value);if(h.length===0)return r;for(var p=h.length-1;p>=0;p--){var d=h[p];if(t.isValidBackgroundAttachment(d))f.value=d;else if(t.isValidBackgroundRepeat(d))a.value=d;else if(t.isValidBackgroundPositionPart(d)||t.isValidBackgroundSizePart(d))if(p>0){var v=h[p-1];if(v.indexOf("/")>0){var m=(new n("/")).split(v);u.value=m.pop()+" "+d,h[p-1]=m.pop()}else p>1&&h[p-2]=="/"?(u.value=v+" "+d,p-=2):h[p-1]=="/"?(u.value=d,s.value=v,p--):(s.value=v+" "+d,p--)}else s.value=d;else if(t.isValidBackgroundPositionAndSize(d)){var g=(new n("/")).split(d);u.value=g.pop(),s.value=g.pop()}else if(l.value!=o[l.prop].defaultValue&&l.value!="none"||!t.isValidColor(d)){if(t.isValidUrl(d)||t.isValidFunction(d))i.value=d}else l.value=d}return r},i.listStyle=function(e){var r=c.makeDefaults(["list-style-type","list-style-position","list-style-image"],e.isImportant),i=r[0],s=r[1],o=r[2];if(e.value==="inherit")return i.value=s.value=o.value="inherit",r;var u=(new n(" ")).split(e.value),a=0;return a<u.length&&t.isValidListStyleType(u[a])&&(i.value=u[a],a++),a<u.length&&t.isValidListStylePosition(u[a])&&(s.value=u[a],a++),a<u.length&&(o.value=u.splice(a,u.length-a+1).join(" ")),r},i._widthStyleColor=function(e,r,i){var s=i.map(function(e){return r+"-"+e}),o=c.makeDefaults(s,e.isImportant),u=o[i.indexOf("color")],a=o[i.indexOf("style")],f=o[i.indexOf("width")];if(e.value==="inherit"||e.value==="inherit inherit inherit")return u.value=a.value=f.value="inherit",o;var l=(new n(" ")).split(e.value),h;return l.length===0?o:(l.length>=1&&(h=l.filter(function(e){return e!=="inherit"&&t.isValidOutlineWidth(e)}),h.length&&(f.value=h[0],l.splice(l.indexOf(h[0]),1))),l.length>=1&&(h=l.filter(function(e){return e!=="inherit"&&t.isValidOutlineStyle(e)}),h.length&&(a.value=h[0],l.splice(l.indexOf(h[0]),1))),l.length>=1&&(h=l.filter(function(e){return t.isValidOutlineColor(e)}),h.length&&(u.value=h[0],l.splice(l.indexOf(h[0]),1))),o)},i.outline=function(e){return i._widthStyleColor(e,"outline",["color","style","width"])},i.border=function(e){return i._widthStyleColor(e,"border",["width","style","color"])},i.borderRadius=function(e){var t=e.value.split("/");if(t.length==1)return i.fourBySpaces(e);var n=e.clone(),r=e.clone();n.value=t[0],r.value=t[1];var s=i.fourBySpaces(n),o=i.fourBySpaces(r);for(var u=0;u<4;u++)s[u].value=[s[u].value,o[u].value];return s};var s={fourUnits:function(e,t,n){t[0].isIrrelevant&&(t[0].value=t[2].value),t[2].isIrrelevant&&(t[2].value=t[0].value),t[1].isIrrelevant&&(t[1].value=t[3].value),t[3].isIrrelevant&&(t[3].value=t[1].value),t[0].isIrrelevant&&t[2].isIrrelevant&&(t[1].value===t[3].value?t[0].value=t[2].value=t[1].value:t[0].value=t[2].value="0"),t[1].isIrrelevant&&t[3].isIrrelevant&&(t[0].value===t[2].value?t[1].value=t[3].value=t[0].value:t[1].value=t[3].value="0");var r=new c(e,t[0].value,n);return r.granularValues=[],r.granularValues[t[0].prop]=t[0].value,r.granularValues[t[1].prop]=t[1].value,r.granularValues[t[2].prop]=t[2].value,r.granularValues[t[3].prop]=t[3].value,t[0].isIrrelevant&&t[1].isIrrelevant&&t[2].isIrrelevant&&t[3].isIrrelevant?(r.value=o[e].shortestValue||o[e].defaultValue,r):t[0].value===t[1].value&&t[0].value===t[2].value&&t[0].value===t[3].value?r:(r.value+=" "+t[1].value,t[0].value===t[2].value&&t[1].value===t[3].value?r:(r.value+=" "+t[2].value,t[1].value===t[3].value?r:(r.value+=" "+t[3].value,r)))},bySpacesOmitDefaults:function(e,t,n,r){var i=new c(e,"",n),s=t.filter(function(e){return e.isIrrelevant});if(s.length===t.length)return i.isIrrelevant=!0,i.value=o[e].shortestValue||o[e].defaultValue,i;var u=o[e].defaultValue;for(var a=0;a<t.length;a++){var f=t[a];i.granularValues=i.granularValues||{},i.granularValues[f.prop]=f.value;if(f.isIrrelevant){var l=o[f.prop].shortestValue||o[f.prop].defaultValue;l.length<u.length&&(u=l)}if(f.isIrrelevant||o[f.prop]&&o[f.prop].defaultValue===f.value)continue;if(r&&r.partsCount&&r.position<r.partsCount-1&&o[f.prop].multiValueLastOnly)continue;var h=o[f.prop].shorthandFollows;h&&t[a-1].value==o[h].defaultValue&&(i.value+=" "+t[a-1].value),i.value+=(o[f.prop].prefixShorthandValueWith||" ")+f.value}return i.value=i.value.trim(),i.value||(i.value=u),i},commaSeparatedMulitpleValues:function(e){return function(t,r,i){var s=r.map(function(e){return(new n(",")).split(e.value).length}),o=Math.max.apply(Math,s);if(o==1)return e(t,r,i);var u=[];for(var a=0;a<o;a++){u.push([]);for(var f=0;f<r.length;f++){var l=(new n(",")).split(r[f].value);u[a].push(l[a]||l[0])}}var c=[],h;for(a=0;a<o;a++){for(var p=0,d=u[a].length;p<d;p++)r[p].value=u[a][p];var v={partsCount:o,position:a},m=e(t,r,i,v);c.push(m.value),h||(h=m)}return h.value=c.join(","),h}},takeCareOfInherit:function(e){return function(t,n,r,i){var s=[],o=[],u=[],a;for(a=0;a<n.length;a++)if(n[a].value==="inherit"){s.push(n[a]);var f=new c(n[a].prop,n[a].isImportant);f.isIrrelevant=!0,u.push(f)}else o.push(n[a]),u.push(n[a]);if(o.length===0)return new c(t,"inherit",r);if(s.length>0){var l=[new c(t,"inherit",r)].concat(o),h=[e(t,u,r,i)].concat(s),p=c.getDetokenizedLength(l),d=c.getDetokenizedLength(h);return p<d?l:h}return e(t,n,r,i)}},borderRadius:function(e,t,n){var r=[];for(var i=0,o=t.length;i<o;i++){var u=t[i];if(!Array.isArray(u.value))continue;u.value.length>1&&r.push({prop:u.prop,value:u.value[1],isImportant:u.isImportant}),u.value=u.value[0]}var a=s.takeCareOfInherit(s.fourUnits)(e,t,n);if(r.length>0){var f=s.takeCareOfInherit(s.fourUnits)(e,r,n);a.value!=f.value&&(a.value+="/"+f.value)}return a}},o={color:{canOverride:r.color,defaultValue:"transparent",shortestValue:"red"},background:{components:["background-image","background-position","background-size","background-repeat","background-attachment","background-color"],breakUp:i.commaSeparatedMulitpleValues(i.background),putTogether:s.commaSeparatedMulitpleValues(s.takeCareOfInherit(s.bySpacesOmitDefaults)),defaultValue:"0 0",shortestValue:"0"},"background-color":{canOverride:r.color,defaultValue:"transparent",multiValueLastOnly:!0,shortestValue:"red"},"background-image":{canOverride:r.backgroundImage,defaultValue:"none"},"background-repeat":{canOverride:r.always,defaultValue:"repeat"},"background-position":{canOverride:r.always,defaultValue:"0 0",shortestValue:"0"},"background-size":{canOverride:r.always,defaultValue:"auto",shortestValue:"0 0",prefixShorthandValueWith:"/",shorthandFollows:"background-position"},"background-attachment":{canOverride:r.always,defaultValue:"scroll"},border:{breakUp:i.border,canOverride:r.border,components:["border-width","border-style","border-color"],defaultValue:"none",putTogether:s.takeCareOfInherit(s.bySpacesOmitDefaults)},"border-color":{canOverride:r.color,defaultValue:"none"},"border-style":{canOverride:r.always,defaultValue:"none"},"border-width":{canOverride:r.unit,defaultValue:"medium",shortestValue:"0"},"list-style":{components:["list-style-type","list-style-position","list-style-image"],canOverride:r.always,breakUp:i.listStyle,putTogether:s.takeCareOfInherit(s.bySpacesOmitDefaults),defaultValue:"outside",shortestValue:"none"},"list-style-type":{canOverride:r.always,shortestValue:"none",defaultValue:"__hack"},"list-style-position":{canOverride:r.always,defaultValue:"outside",shortestValue:"inside"},"list-style-image":{canOverride:r.always,defaultValue:"none"},outline:{components:["outline-color","outline-style","outline-width"],breakUp:i.outline,putTogether:s.takeCareOfInherit(s.bySpacesOmitDefaults),defaultValue:"0"},"outline-color":{canOverride:r.color,defaultValue:"invert",shortestValue:"red"},"outline-style":{canOverride:r.always,defaultValue:"none"},"outline-width":{canOverride:r.unit,defaultValue:"medium",shortestValue:"0"},"-moz-transform":{canOverride:r.sameFunctionOrValue},"-ms-transform":{canOverride:r.sameFunctionOrValue},"-webkit-transform":{canOverride:r.sameFunctionOrValue},transform:{canOverride:r.sameFunctionOrValue}},u=function(e,t,n){n=n||{},o[e]={components:t,breakUp:n.breakUp||i.fourBySpaces,putTogether:n.putTogether||s.takeCareOfInherit(s.fourUnits),defaultValue:n.defaultValue||"0",shortestValue:n.shortestValue};for(var u=0;u<t.length;u++)o[t[u]]={breakUp:n.breakUp||i.fourBySpaces,canOverride:n.canOverride||r.unit,defaultValue:n.defaultValue||"0",shortestValue:n.shortestValue}};["","-moz-","-o-","-webkit-"].forEach(function(e){u(e+"border-radius",[e+"border-top-left-radius",e+"border-top-right-radius",e+"border-bottom-right-radius",e+"border-bottom-left-radius"],{breakUp:i.borderRadius,putTogether:s.borderRadius})}),u("border-color",["border-top-color","border-right-color","border-bottom-color","border-left-color"],{breakUp:i.fourBySpaces,canOverride:r.color,defaultValue:"currentColor",shortestValue:"red"}),u("border-style",["border-top-style","border-right-style","border-bottom-style","border-left-style"],{breakUp:i.fourBySpaces,canOverride:r.always,defaultValue:"none"}),u("border-width",["border-top-width","border-right-width","border-bottom-width","border-left-width"],{defaultValue:"medium",shortestValue:"0"}),u("padding",["padding-top","padding-right","padding-bottom","padding-left"]),u("margin",["margin-top","margin-right","margin-bottom","margin-left"]);for(var a in o){if(!o.hasOwnProperty(a))continue;var f=o[a];if(!(f.components instanceof Array&&f.components.length!==0))continue;f.isShorthand=!0;for(var l=0;l<f.components.length;l++){if(!o[f.components[l]])throw new Error('"'+f.components[l]+'" is defined as a component of "'+a+"\" but isn't defined in processable.");o[f.components[l]].componentOf=a}}var c=e.createTokenPrototype(o);return{implementedFor:/background|border|color|list|margin|outline|padding|transform/,processable:o,Token:c}}();