var processableInfo=require("./processable"),overrideCompactor=require("./override-compactor"),shorthandCompactor=require("./shorthand-compactor");module.exports=function(t,n){var r={"animation-delay":["animation"],"animation-direction":["animation"],"animation-duration":["animation"],"animation-fill-mode":["animation"],"animation-iteration-count":["animation"],"animation-name":["animation"],"animation-play-state":["animation"],"animation-timing-function":["animation"],"-moz-animation-delay":["-moz-animation"],"-moz-animation-direction":["-moz-animation"],"-moz-animation-duration":["-moz-animation"],"-moz-animation-fill-mode":["-moz-animation"],"-moz-animation-iteration-count":["-moz-animation"],"-moz-animation-name":["-moz-animation"],"-moz-animation-play-state":["-moz-animation"],"-moz-animation-timing-function":["-moz-animation"],"-o-animation-delay":["-o-animation"],"-o-animation-direction":["-o-animation"],"-o-animation-duration":["-o-animation"],"-o-animation-fill-mode":["-o-animation"],"-o-animation-iteration-count":["-o-animation"],"-o-animation-name":["-o-animation"],"-o-animation-play-state":["-o-animation"],"-o-animation-timing-function":["-o-animation"],"-webkit-animation-delay":["-webkit-animation"],"-webkit-animation-direction":["-webkit-animation"],"-webkit-animation-duration":["-webkit-animation"],"-webkit-animation-fill-mode":["-webkit-animation"],"-webkit-animation-iteration-count":["-webkit-animation"],"-webkit-animation-name":["-webkit-animation"],"-webkit-animation-play-state":["-webkit-animation"],"-webkit-animation-timing-function":["-webkit-animation"],"background-attachment":["background"],"background-clip":["background"],"background-color":["background"],"background-image":["background"],"background-origin":["background"],"background-position":["background"],"background-repeat":["background"],"background-size":["background"],"border-color":["border"],"border-style":["border"],"border-width":["border"],"border-bottom":["border"],"border-bottom-color":["border-bottom","border-color","border"],"border-bottom-style":["border-bottom","border-style","border"],"border-bottom-width":["border-bottom","border-width","border"],"border-left":["border"],"border-left-color":["border-left","border-color","border"],"border-left-style":["border-left","border-style","border"],"border-left-width":["border-left","border-width","border"],"border-right":["border"],"border-right-color":["border-right","border-color","border"],"border-right-style":["border-right","border-style","border"],"border-right-width":["border-right","border-width","border"],"border-top":["border"],"border-top-color":["border-top","border-color","border"],"border-top-style":["border-top","border-style","border"],"border-top-width":["border-top","border-width","border"],"font-family":["font"],"font-size":["font"],"font-style":["font"],"font-variant":["font"],"font-weight":["font"],"list-style-image":["list-style"],"list-style-position":["list-style"],"list-style-type":["list-style"],"margin-bottom":["margin"],"margin-left":["margin"],"margin-right":["margin"],"margin-top":["margin"],"outline-color":["outline"],"outline-style":["outline"],"outline-width":["outline"],"padding-bottom":["padding"],"padding-left":["padding"],"padding-right":["padding"],"padding-top":["padding"],"transition-delay":["transition"],"transition-duration":["transition"],"transition-property":["transition"],"transition-timing-function":["transition"],"-moz-transition-delay":["-moz-transition"],"-moz-transition-duration":["-moz-transition"],"-moz-transition-property":["-moz-transition"],"-moz-transition-timing-function":["-moz-transition"],"-o-transition-delay":["-o-transition"],"-o-transition-duration":["-o-transition"],"-o-transition-property":["-o-transition"],"-o-transition-timing-function":["-o-transition"],"-webkit-transition-delay":["-webkit-transition"],"-webkit-transition-duration":["-webkit-transition"],"-webkit-transition-property":["-webkit-transition"],"-webkit-transition-timing-function":["-webkit-transition"]},i="\\9",s={};for(var o in r)for(var u=0;u<r[o].length;u++){var a=r[o][u],f=s[a];f?f.push(o):s[a]=[o]}var l=function(e){var t=e.split(";"),n=[];if(t.length===0||t.length==1&&t[0].indexOf(i)==-1)return;for(var r=0,s=t.length;r<s;r++){var o=t[r];if(o==="")continue;var u=o.indexOf(":");n.push([o.substring(0,u),o.substring(u+1),o.indexOf("!important")>-1,o.indexOf(i,u+1)===o.length-i.length])}return n},c=function(e,i){var o=[],u=[],a=null,f={},l=function(e,t){var n=s[e];for(var r=0,i=n.length;r<i;r++)for(var a=0;a<u.length;a++){if(u[a]!=n[r]||o[a][2]&&!t)continue;o.splice(a,1),u.splice(a,1),a-=1}},c=function(e){return i===!1||i===!0?i:i.indexOf(e)>-1};e:for(var h=0,p=e.length;h<p;h++){var d=e[h],v=d[0],m=d[1],g=d[2],y=d[3],b=v=="-ms-filter"||v=="filter"?a=="background"||a=="background-image"?a:v:v,w=0;if(!t&&y)continue;if(n&&b!=a||c(h))for(;;){w=u.indexOf(b,w);if(w==-1)break;var E=o[w],S=E[2],x=E[3];if(S&&!g)continue e;if(t&&!x&&y)break;var T=processableInfo.processable[b];if(!y&&!x&&T&&T.canOverride&&!T.canOverride(e[w][1],m))break;o.splice(w,1),u.splice(w,1)}o.push(d),u.push(b),f[b]&&l(b,g);for(var N=0,C=r[b]||[],k=C.length;N<k;N++)f[C[N]]=!0;a=b}return o},h=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n][0]+":"+e[n][1]);return t.join(";")},p=function(e){var t=processableInfo.processable,n=processableInfo.Token,r=n.tokenize(e);return r=overrideCompactor.compactOverrides(r,t),r=shorthandCompactor.compactShorthands(r,!1,t,n),r=shorthandCompactor.compactShorthands(r,!0,t,n),n.detokenize(r)};return{process:function(e,t,n){var r=e,i=l(e);if(i){var s=c(i,t);r=h(s)}return!n&&processableInfo.implementedFor.test(r)&&(r=p(r)),r}}};