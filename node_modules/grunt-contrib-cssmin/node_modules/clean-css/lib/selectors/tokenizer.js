module.exports=function(t,n){var r=new Chunker(t,128),i=r.next(),s=/(^@(font\-face|page|\-ms\-viewport|\-o\-viewport|viewport)|\\@.+?)/,o=function(e){var t=e.cursor,n=e.mode,s;if(i.length==e.cursor){if(r.isEmpty())return null;i=r.next(),e.cursor=0}if(n=="body")return s=i.indexOf("}",t),s>-1?[s,"bodyEnd"]:null;var o=i.indexOf("@",e.cursor),u=n=="top"?i.indexOf("__ESCAPED_COMMENT_CLEAN_CSS",e.cursor):-1,a=i.indexOf("{",e.cursor),f=i.indexOf("}",e.cursor);s=o;if(s==-1||u>-1&&u<s)s=u;if(s==-1||a>-1&&a<s)s=a;if(s==-1||f>-1&&f<s)s=f;if(s==-1)return;if(u===s)return[s,"escape"];if(a===s)return[s,"bodyStart"];if(f===s)return[s,"bodyEnd"];if(o===s)return[s,"special"]},u=function(e){var t=[];e=e||{cursor:0,mode:"top"};for(;;){var r=o(e);if(!r){var a=i.substring(e.cursor);a.length>0&&(t.push(a),e.cursor+=a.length);break}var f=r[0],l=r[1],c,h;if(l=="special"){var p=i.indexOf("{",f),d=i.indexOf(";",f),v=d>-1&&(p==-1||d<p);if(v)c=i.indexOf(";",f+1),t.push(i.substring(e.cursor,c+1)),e.cursor=c+1;else{c=i.indexOf("{",f+1);var m=i.substring(e.cursor,c).trim(),g=s.test(m);h=e.mode,e.cursor=c+1,e.mode=g?"body":"block";var y=u(e);e.mode=h,t.push({block:m,body:y})}}else if(l=="escape"){c=i.indexOf("__",f+1);var b=i.substring(e.cursor,c+2);t.push(b),e.cursor=c+2}else if(l=="bodyStart"){var w=i.substring(e.cursor,f).trim();h=e.mode,e.cursor=f+1,e.mode="body";var E=u(e);e.mode=h,t.push({selector:w,body:E})}else if(l=="bodyEnd"){if(e.mode=="top"){var S=e.cursor,x=i[e.cursor]=="}"?"Unexpected '}' in '"+i.substring(S-20,S+20)+"'. Ignoring.":"Unexpected content: '"+i.substring(S,f+1)+"'. Ignoring.";n.warnings.push(x),e.cursor=f+1;continue}e.mode!="block"&&(t=i.substring(e.cursor,f)),e.cursor=f+1;break}}return t};return{process:function(){return u()}}};var Chunker=function(e,t){var n=[];for(var r=0,i=e.length;r<i;){var s=r+t>i?i-1:r+t;e[s]!="}"&&(s=e.indexOf("}",s)),s==-1&&(s=e.length-1),n.push(e.substring(r,s+1)),r=s+1}return{isEmpty:function(){return n.length===0},next:function(){return n.shift()||""}}};